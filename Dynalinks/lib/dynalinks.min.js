function Dynalinks(a,b){this.database=a.database,this.names=a.names,this.categories={},this.display=b}function check_key(a,b){for(var c in a)if(c===b)return!0;return!1}function Application(a){this.database=a;var b=this;document.addEventListener("DOMContentLoaded",function(a){b.Initialize()&&b.Initialize()})}function PopupForm(a){this.dict=a.dict,this.selected=a.selected,this.type=a.type,this.template=a.template,this.handler=a.handler,this.change_text=a.change_text,this.title=a.title,this.not_escape=a.not_escape,this.text="",this.result=-1;var b=!0;this.initialize=function(){if(b){Form_Fabric.not_escape=!!a.not_escape,a.form?this.form=a.form:a.fields?this.form=Form_Fabric.create_fields(a.fields):this.form=Form_Fabric.create(a.type,a.value,a.dict),this.create_template(a);var c=this.template.querySelector(".mt-input-container");c?c.innerHTML="":(c=document.createElement("div"),c.className="mt-input-container",console.log("not found mt-input-container, need create it"),this.template.appendChild(c)),c.appendChild(this.form);var d=this;c=this.template.querySelector(".edit-form-ok-btn"),c.onclick=function(a){d._ok()},c=this.template.querySelector(".edit-form-cancel-btn"),c.onclick=function(a){d.cancel()},this.init(),b=!1}}}function ModalForm(){PopupForm.apply(this,arguments)}function My_Router(){this.routes=new Array}function get_first_key(a){for(var b in a)if(a.hasOwnProperty(b))return b}function get_first_key_secure(a){for(var b in a)if(a.hasOwnProperty(b)&&"undefined"!=typeof a[b])return b}function find_all_by_field_value(a,b,c){for(var d=new Array,e=0;e<a.length;e++){var f=a[e][b];c===f&&d.push(a[e])}return d}function find_by_field_value(a,b,c){for(var d=0;d<a.length;d++){var e=a[d][b];if(c===e)return a[d]}return null}function remove_by_field_value(a,b,c){for(var d=0;d<a.length;d++){var e=a[d][b];if(c===e){var f=a[d];return a.splice(d,1),f}}return null}function remove_all_by_field_value(a,b,c){for(var d=0;d<a.length;){var e=a[d][b];c===e?a.splice(d,1):d++}return null}function dictionary_to_array(a,b,c){b||(b="key"),c||(c="value");var d=new Array,e={};for(var f in a)a.hasOwnProperty(f)&&(e={},e[b]=f,e[c]=a[f],d.push(e));return d}function create_url(){for(var a="",b=0;b<arguments.length;b++)"undefined"!=typeof arguments[b]&&(b>0&&(a+="/"),a+=encodeURIComponent(arguments[b]));return a}Dynalinks.Utils={},Dynalinks.Utils.create_id=function(){return Math.random().toString(36).substr(2,9)+Date.now().toString()},Dynalinks.Utils.check_item=function(a){a._id||(a._id=Dynalinks.Utils.create_id()),a.favorite&&!a.favorite_text&&(a.favorite_text=a.text),!a.favorite&&a.favorite_text&&(a.favorite=!0)},Dynalinks.Utils.check_database=function(a){for(var b in a){arr=a[b];for(var c=0;c<arr.length;c++)Dynalinks.Utils.check_item(arr[c])}},Dynalinks.prototype.create_url=function(a,b){var c=Array.prototype.slice.call(arguments,0);return c.unshift("view"),create_url.apply(this,c)},Dynalinks.prototype.Database_Name="database.txt",Dynalinks.Context=function(a,b){if(this.category_name=b,this.pages={},this.favorites=new Array,this.tags=ko.observableArray(),this.hash={},a){for(var c,d,e=0;e<a.length;e++)c=a[e],this.hash[c._id]=c,d=c.tag,this.pages[d]||(this.pages[d]=new Array,this.tags.push(d)),this.pages[d].push(c),c.favorite&&this.favorites.push(c);this.favorites=ko.observableArray(this.favorites)}},Dynalinks.Context.prototype.move_item=function(a,b){var c=this.get_page(a.tag),d=this.get_page(b);d.push(a),a.tag=b,remove_by_field_value(c,"_id",a._id)},Dynalinks.Context.prototype.change_favorite=function(a,b,c){function d(a,b,c){var d="";if(b){var d=c||a.favorite_text||a.text;c&&c!==d&&(d=c)}return d}function e(a,b){a.remove(function(a){return a._id===b._id}),a.push(b)}if(a.favorite!==b||a.favorite_text!==c){var f=d(a,b,c),g=!0;a.favorite!==b&&(a.favorite=b,a.favorite?(a.favorite_text=f,this.favorites.push(a)):(this.favorites.remove(function(b){return b._id===a._id}),delete a.favorite_text),g=!1),a.favorite&&a.favorite_text!==f&&(a.favorite_text=f,g&&e(this.favorites,a)),this.favorites.valueHasMutated()}},Dynalinks.Context.prototype.get_page=function(a){var b=this.pages[a];return b||(this.pages[a]=b=new Array,this.tags.push(a)),b},Dynalinks.Context.prototype.remove_page=function(a){var b=this.pages[a];if(delete this.pages[a],b){for(var c=0;c<b.length;c++)delete this.hash[b._id];this.tags.remove(function(b){return b===a}),this.favorites.remove(function(b){return b.tag===a})}},Dynalinks.Context.prototype.add_item=function(a){if(Dynalinks.Utils.check_item(a),!this.hash[a._id]){var b=this.get_page(a.tag);b.push(a),a.favorite&&this.favorites.push(a),this.hash[a._id]=a}},Dynalinks.Context.prototype.remove_item=function(a){if(this.hash[a._id]){a.favorite&&this.favorites.remove(function(b){return b._id===a._id});var b=this.get_page(a.tag);remove_by_field_value(b,"_id",a._id),delete this.hash[a._id]}},Dynalinks.prototype.create_context=function(a){var b=this.database[a];if(!b)return console.log("error! Not found category ",a),null;var c=new Dynalinks.Context(b,a);return c},Dynalinks.prototype.get_category_context=function(a,b){var c=this.categories[a];return c&&!b||(this.categories[a]=c=this.create_context(a)),c},Dynalinks.prototype.get_active_context=function(){return this.get_category_context(this.current_category)},Dynalinks.prototype.show_category=function(a){if(a&&this.names[a]||(console.log("Category "+a+" not found"),a=get_first_key(this.names))){console.log("show category");var b=this.get_category_context(a);this.context=b,this.current_category=a;var c=document.getElementById("page-menu");ko.cleanNode(c),c.innerHTML="",ko.applyBindings(b,c);var d=document.getElementById("favorites-menu");ko.cleanNode(d),d.innerHTML="",ko.applyBindings(b,d)}},Dynalinks.prototype.get_page_template=function(){return this.templates[this.display_mode]},Dynalinks.prototype.show_page=function(a){if(this.context=this.get_active_context(),this.context){if(!a||!this.context.pages[a]){var b=a;a=get_first_key_secure(this.context.pages),console.log("page "+b+" not found, show page "+a),a||console.log("category is empty, there are not page for show they")}this.context.current_tag=a,this.context.display=this.display;var c=document.getElementById("page-content");ko.cleanNode(c),c.innerHTML="",ko.applyBindings(this.context,c)}},Dynalinks.prototype.show_category_menu=function(){this.category_menu=ko.observableArray(dictionary_to_array(this.names,"hash","text")),ko.applyBindings(this,document.getElementById("category-menu"))},Dynalinks.prototype.initialize=function(){this.show_category_menu()},Dynalinks.prototype.add_link_to_category=function(a,b){this.database[b]||console.log("Error! This category doesn't exits!",b),this.database[b].push(a);var c=this.get_category_context(b);c.add_item(a)},Dynalinks.prototype.remove_by_id=function(a){var b=remove_by_field_value(this.database[this.context.category_name],"_id",a);this.context.remove_item(b),this.show_page(b.tag)},Dynalinks.prototype.add_category=function(a){return this.database[a]?void alert("Категория с таким названием уже существует!"):a?(this.database[a]=new Array,this.names[a]=a,void this.category_menu.push({hash:a,text:a})):void alert("Имя новой категории не задано!")},Dynalinks.prototype.remove_tag=function(a,b){remove_all_by_field_value(this.database[a],"tag",b);var c=this.get_category_context(a);c.remove_page(b)},Dynalinks.prototype.move_tag=function(a,b,c){if(b!==c){this.names[c]||this.add_category(c);for(var d=this.database[b],e=this.database[c],f=0;f<d.length;)d[f].tag===a?(e.push(d[f]),d.splice(f,1)):f++;this.get_category_context(b,!0),this.get_category_context(c,!0)}},Dynalinks.prototype.save_data_to_file=function(a,b,c){var d=JSON.stringify(b,null," ");d="var "+c+" = "+d+";\n";var e=new Blob([d],{type:"text/plain;charset=utf-8"});saveAs(e,a)},Dynalinks.prototype.save_to_file=function(a,b){var c={database:this.database,names:this.names};this.save_data_to_file(a||this.Database_Name,c,this.Database_Var)},Dynalinks.prototype.get_from_active_context=function(a){return find_by_field_value(this.database[this.context.category_name],"_id",a)},Dynalinks.prototype.update_item=function(a,b){this.context.change_favorite(a,b.favorite,b.favorite_text);for(var c in b)Object.prototype.hasOwnProperty.call(a,c)&&"new_tag"!==c&&"tag"!==c&&"favorite_text"!==c&&"favorite"!==c&&(a[c]=b[c]);return(a.tag!==b.tag||b.new_tag)&&this.context.move_item(a,b.new_tag||b.tag),{category:this.context.category_name,tag:a.tag}},Dynalinks.prototype.export_category=function(a){this.save_data_to_file(a+".txt",this.database[a],"my_cat")},Dynalinks.prototype.export_tag=function(a,b){var c=this.get_category_context(a),d=c.pages[b];this.save_data_to_file(b+".txt",d,"my_page")},Dynalinks.prototype.remove_category=function(a){this.database[a]&&delete this.database[a],this.categories[a]&&delete this.categories[a],this.names[a]&&delete this.names[a],this.category_menu.remove(function(b){return b.hash===a})},Dynalinks.prototype.search=function(a,b){var c,d,b=b.toUpperCase(),e=new Array;for(var f in this.names)Object.prototype.hasOwnProperty.call(this.names,f)&&(d=f,c=this.database[d],c.forEach(function(c){a.every(function(a){var f=c[a].toUpperCase();return f.search(b)===-1||(e.push({item:c,cat:d}),!1)})}));return e};var mr;Application.prototype.remove_item=function(a){var b=this,c={type:"label",value:"Правда удалить?",handler:function(c){b.dynalinks.remove_by_id(a)}},d=new PopupForm(c);d.show()},Application.prototype.move_tag=function(){var a={};a.title="Перенести страницу в другую категорию",a.type="custom",a.dict=dynalinks.names,a.fields=[{type:"select",dict:dynalinks.names,"data-value":"category"},{type:"text","data-value":"new_category"}];var b=this;a.handler=function(a){var c=b.dynalinks.context.current_tag,d=b.dynalinks.context.category_name,e=a.new_category||a.category;b.dynalinks.move_tag(c,d,e),mr.navigate(b.dynalinks.create_url(e,c),!0)};var c=new PopupForm(a);c.show()},Application.prototype.add_item=function(){var a={};a.type="custom";var b=document.createElement("div"),c={};c.tags=this.dynalinks.context.tags,c.value=[this.dynalinks.context.current_tag],ko.renderTemplate("create-item-template",c,{},b),a.form=b;var d=this;a.handler=function(a){a.new_tag&&(a.tag=a.new_tag,delete a.new_tag);var b=d.dynalinks.context.category_name,c=a.tag;d.dynalinks.add_link_to_category(a,b),mr.navigate(d.dynalinks.create_url(b,c),!0)};var e=new PopupForm(a);e.show()},Application.prototype.edit_item=function(a){var b=this.dynalinks.get_from_active_context(a),c={type:"custom"},d=document.createElement("div"),e={};e.tags=this.dynalinks.context.tags,e.item=b,ko.renderTemplate("edit-item-template",e,{},d),c.form=d;var f=this;c.handler=function(a){var c=f.dynalinks.update_item(b,a);mr.navigate(f.dynalinks.create_url(c.category,c.tag),!0)};var g=new PopupForm(c);g.show()},Application.prototype.turn_edit=function(){"page_view"===this.dynalinks.display.mode?this.dynalinks.display.mode="page_edit":this.dynalinks.display.mode="page_view",this.dynalinks.show_page(this.dynalinks.context.current_tag)},Application.prototype.export_category=function(){this.dynalinks.export_category(this.dynalinks.context.category_name)},Application.prototype.export_tag=function(){this.dynalinks.export_tag(this.dynalinks.context.category_name,this.dynalinks.context.current_tag)},Application.prototype.remove_category=function(){var a={type:"label",value:"Правда удалить эту категорию?"},b=this;a.handler=function(a){b.dynalinks.remove_category(b.dynalinks.context.category_name),mr.navigate(b.dynalinks.create_url(get_first_key(b.dynalinks.names)),!0)};var c=new PopupForm(a);c.show()},Application.prototype.remove_tag=function(){var a={type:"label",value:"Правда удалить эту страницу?"},b=this;a.handler=function(a){b.dynalinks.remove_tag(b.dynalinks.context.category_name,b.dynalinks.context.current_tag),mr.navigate(this.dynalinks.create_url(b.dynalinks.context.category_name),!0)};var c=new PopupForm(a);c.show()},Application.prototype.create_category=function(){var a={};a.type="text",a.title="Название новой папки";var b=this;a.handler=function(a){b.dynalinks.add_category(a),mr.navigate(b.dynalinks.create_url(a),!0)};var c=new PopupForm(a);c.show()},Application.prototype.move_item=function(){},Application.prototype.search=function(a){var b=a.trim();b&&mr.navigate(create_url("search",b),!0)},Application.prototype.show_search_results=function(a){var b=this.dynalinks.search(["text","href"],a),c={results:b},d=document.getElementById("page-content");ko.cleanNode(d),d.innerHTML="",ko.renderTemplate("template-search-result",c,{},d)},Application.prototype.init_router=function(){mr=new My_Router,mr.add_route("view/:category/:page",function(a,b){this.current_category&&this.current_category===a?this.show_page(b):(this.show_category(a),this.show_page(b))},this.dynalinks),mr.add_route("view/:category",function(a){this.show_category(a),this.show_page(null)},this.dynalinks),mr.add_default(function(){this.show_category(null),this.show_page(null)},this.dynalinks),mr.add_route("search/:value",function(a){this.show_search_results(decodeURIComponent(a))},this),mr.start(!0)};var dynalinks;Application.prototype.Initialize=function(){var a=this,b=window.location.href.split("#")[0].split("/");b=b[b.length-1].split("."),this.Save_Filename=b[0]+".txt";var c={};this.display=c,c.mode="page_view",c.templates={},c.templates.page_edit="template-page-content-edit",c.templates.page_view="template-page-content",dynalinks=this.dynalinks=new Dynalinks(this.database,c),ko.bindingHandlers.livelink={init:function(b,c,d,e,f){var g=ko.unwrap(c()),h=f.$parent.category_name;b.href="#"+a.dynalinks.create_url(h,g)},update:function(b,c,d,e,f){var g=ko.unwrap(c()),h=f.$parent.category_name;b.href="#"+a.dynalinks.create_url(h,g)}},this.init_router(),this._child_init&&this._child_init(),dynalinks.initialize(),document.getElementById("button-edit-page").onclick=function(b){a.turn_edit()};document.getElementById("button-add").onclick=function(){a.add_item()};document.getElementById("search-button").onclick=function(){a.search(document.getElementById("search-box").value)},document.getElementById("button-create-category").onclick=function(){a.create_category()},document.getElementById("button-remove-category").onclick=function(){a.remove_category()},document.getElementById("button-remove-tag").onclick=function(){a.remove_tag()},document.getElementById("button-save").onclick=function(){dynalinks.save_to_file(a.Save_Filename)},document.getElementById("button-move").onclick=function(){a.move_tag()},document.getElementById("button-export-category").onclick=function(){a.export_category()},document.getElementById("button-export-tag").onclick=function(){a.export_tag()},document.getElementById("page-content").addEventListener("click",function(b){var c=b.target||b.srcElement;"delete-btn"===c.className?a.remove_item(c.getAttribute("data-id")):"edit-btn"===c.className&&a.edit_item(c.getAttribute("data-id"))},!1)},function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(a){}var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;i<j;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return e<3&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,c){var d=c?c.type||"":"",e=new b;if(a)for(var f=0,g=a.length;f<g;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var Form_Fabric={};Form_Fabric.escape_text=function(a){return this.not_escape?a:a.replace(/'|"/g,"&quot;").replace(/</g,"$lt;").replace(/>/g,"$gt;")},Form_Fabric.select=function(a,b){var c=!("undefined"==typeof b),d="";if(Array.isArray(a))for(var e=0,f=a.length;e<f;e++)d+='<option value="'+e+'"',c&&b==e&&(d+=" selected "),d+=">"+a[e]+"</option>";else for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d+='<option value="'+e+'"',c&&b===e&&(d+=" selected "),d+=">"+a[e]+"</option>");var g=document.createElement("select");return g.innerHTML=d,g},Form_Fabric.text=function(a){var b=document.createElement("input");return b.type="text",a&&(b.value=Form_Fabric.escape_text(a||"")),b},Form_Fabric.label=function(a){var b=document.createElement("div");return b.className="popup-form-static-text",b.style["text-align"]="center",b.innerHTML="<h3>"+Form_Fabric.escape_text(a||" ")+"</h3>",b},Form_Fabric.textarea=function(a){var b=document.createElement("textarea");return a&&(b.value=Form_Fabric.escape_text(a||"")),b},Form_Fabric.create=function(a,b,c){var d=this[a];if(!d)throw a;var e;return e="select"===a?d(c,b):d(b)},Form_Fabric.create_fields=function(a){for(var b,c,d,e=document.createElement("div"),f=0;f<a.length;f++)b=a[f],c=this.create(b.type,b.value,b.dict),"data-value"in b&&c.setAttribute("data-value",b["data-value"]),d=document.createElement("div"),d.className="dummy",d.appendChild(c),e.appendChild(d);return e},PopupForm.prototype.make_unique=function(){this.constructor.prototype.onshow&&this.constructor.prototype.onshow.cancel(),this.constructor.prototype.onshow=this},PopupForm.prototype.close_unique=function(){this.constructor.prototype.onshow=null},PopupForm.prototype.onshow=null,PopupForm.prototype.create_template=function(a){if(!this.template){this.template=document.createElement("div"),this.template.className="edit-form-container",this.template.style["background-color"]="#FFFFFF";var b=this.title?'<h3 class="edit-form-title">'+this.escape_text(this.title)+"</h3>":"";b+='<div class="mt-input-container"></div><button class="edit-form-ok-btn">ОК</button><button class="edit-form-cancel-btn">Отмена</button>',this.template.innerHTML=b,this.template.style.background_color="#FFFFFF",this.template.style.padding="5px",this.template.style["box-shadow"]="0 0 10px rgba(0,0,0,0.5)"}this.template.style.position="fixed"},PopupForm.prototype.escape_text=function(a){return a.replace(/'|"/g,"&quot;").replace(/</,"$lt;").replace(/>/,"$gt;")},PopupForm.prototype.init=function(){var a=this;a.template.onkeydown=function(b){switch(b.keyCode){case 27:a.cancel();break;case 13:a._ok()}}},PopupForm.prototype.attach_focus=function(){var a=this;a.template.on("blur",function(b){a.cancel()})},PopupForm.prototype.insert=function(){this.template.style.display="block",document.body.appendChild(this.template);var a=window.innerWidth/2-this.template.offsetWidth/2,b=window.innerHeight/2-this.template.offsetHeight/2;this.template.style.left=a+"px",this.template.style.top=b+"px"},PopupForm.prototype.detach=function(){this.template.parentNode.removeChild(this.template)},PopupForm.prototype.save_text=function(a){},PopupForm.prototype.show=function(a){this.initialize(),this.make_unique(),this.jquery_obj=a,this.change_text&&a&&this.save_text(a),this.insert(),this.result=-1,this.form.focus()},PopupForm.prototype.hide=function(){this.close_unique(),this.detach(),this.change_text&&this.jquery_obj},PopupForm.prototype.cancel=function(){this.hide()},PopupForm.prototype._get_values_from_inputs=function(a,b){if(b)for(var c,d=0;d<b.length;d++)b[d].hasAttribute("data-value")&&(c=b[d].getAttribute("data-value"),"checkbox"===b[d].type?a[c]=!!b[d].checked:"text"==b[d].type?this.not_escape?a[c]=b[d].value:a[c]=this.escape_text(b[d].value):a[c]=b[d].value)},PopupForm.prototype._get_value=function(){var a;return"custom"===this.type?(a={},this._get_values_from_inputs(a,this.form.querySelectorAll("input")),this._get_values_from_inputs(a,this.form.querySelectorAll("select")),this._get_values_from_inputs(a,this.form.querySelectorAll("textarea"))):"select"===this.type?a=this.form.options[this.form.selectedIndex].value:"text"===this.type?(a=this.form.value,this.not_escape||(a=this.escape_text(a))):"textarea"===this.type&&(a=this.form.value,this.not_escape||(a=this.escape_text(a))),a},PopupForm.prototype._ok=function(){if(value=this._get_value(),this.hide(),this.handler){var a=this.handler(value);a&&(this.result=value,this.text=this.dict?this.dict[value]:value)}},ModalForm.prototype=Object.create(PopupForm.prototype),ModalForm.prototype.constructor=ModalForm,ModalForm.prototype.onShow=null,ModalForm.prototype.create_template=function(a){if(!this.template){this.template=$('<form class="modal-edit-form-container">');var b="";a.title&&(b='<div class="mt-edit-title"><i><h3>'+a.title+"</h3></i></div>"),b+='<div class="modal-edit-form mt-input-container"></div><div><button class="inplace-edit-ok">ОК</button><button class="inplace-edit-cancel">Отмена</button></div>',this.template.html(b),this.template.css({"background-color":"#FFFFFF"}),this.template.css({padding:"5px"}),this.template.css({"box-shadow":"0 0 10px rgba(0,0,0,0.5)"})}this.template.css({position:"absolute"})},ModalForm.prototype.insert=function(){$(document.body).append(this.template),this.template.css({display:"block"}),this.template.css({position:"fixed",left:"50%",top:"50%"}),this.template.css({"margin-left":-this.template.outerWidth()/2+"px","margin-top":-this.template.outerHeight()/2+"px"})};var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e=!a.externalHost&&"download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=10,m=function(b){var d=function(){"string"==typeof b?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,l)},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){i(a)}}},o=function(b,i){var l,o,p,q=this,r=b.type,s=!1,t=function(){n(q,"writestart progress write writeend".split(" "))},u=function(){if(!s&&l||(l=c().createObjectURL(b)),o)o.location.href=l;else{var d=a.open(l,"_blank");void 0==d&&"undefined"!=typeof safari&&(a.location.href=l)}q.readyState=q.DONE,t(),m(l)},v=function(a){return function(){if(q.readyState!==q.DONE)return a.apply(this,arguments)}},w={create:!0,exclusive:!1};return q.readyState=q.INIT,i||(i="download"),e?(l=c().createObjectURL(b),d.href=l,d.download=i,f(d),q.readyState=q.DONE,t(),void m(l)):(a.chrome&&r&&r!==j&&(p=b.slice||b.webkitSlice,b=p.call(b,0,b.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=b.size,void h(a.TEMPORARY,k,v(function(a){a.root.getDirectory("saved",w,v(function(a){var c=function(){a.getFile(i,w,v(function(a){a.createWriter(v(function(c){c.onwriteend=function(b){o.location.href=a.toURL(),q.readyState=q.DONE,n(q,"writeend",b),m(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&u()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=q["on"+a]}),c.write(b),q.abort=function(){c.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),u)}),u)};a.getFile(i,{create:!1},v(function(a){a.remove(),c()}),v(function(a){a.code===a.NOT_FOUND_ERR?c():u()}))}),u)}),u)):void u())},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),My_Router.prototype.decode_params=function(a){for(var b=0;b<a.length;b++)a[b]=decodeURIComponent(a[b])},My_Router.prototype.test_hash=function(a){for(var b,c,d=0;d<this.routes.length;d++)if(b=this.routes[d],b.re.lastIndex=0,c=b.re.exec(a))return c.length>1&&c.splice(0,1),this.decode_params(c),b.callback.apply(b.obj,c),!0;this.default_route&&this.default_route.callback.apply(this.default_route.obj,[a])},My_Router.prototype.add_default=function(a,b){this.default_route={callback:a,obj:b}},My_Router.prototype._add=function(a,b,c){return this.routes.push({re:a,callback:b,obj:c})},My_Router.prototype.add_route=function(a,b,c){for(var d,e=a.split("/"),f="^",g=0;g<e.length;g++)d=e[g],(!d||g>0)&&(f+="/"),d&&(f+=":"===d[0]?"([^/]+?)":d);f+="$",this._add(new RegExp(f),b,c)},My_Router.prototype.hash_change=function(a){var b=window.location.hash;b&&(b=b.split("#"),b.length>1&&(b=b[1]),b&&"/"==b[0]&&(b=b.slice(1))),this.test_hash(b)},My_Router.prototype.refresh=function(){this.hash_change()},My_Router.prototype.navigate=function(a,b){if(b){var c="#"+a;window.location.hash==c?this.test_hash(a):window.location.hash=c}else this.test_hash(a)},My_Router.prototype.start=function(a){var b=this;window.addEventListener("hashchange",function(a){b.hash_change(a)},!1),a&&this.hash_change()},Application.prototype._child_init=function(){this.dynalinks.Database_Var="my_links",this.register_ko_items()},Application.prototype.register_ko_items=function(){ko.components.register("autodate",{template:'<p data-value="date", data-bind= "text: now_date">',viewModel:function(a){this.get_date=function(){return(new Date).toISOstring()};var b=new Date;this.now_date=b.toISOString()}}),ko.bindingHandlers.my_text={init:function(a,b,c,d,e){var f=ko.unwrap(b());a.value=f},update:function(a,b,c,d,e){var f=ko.unwrap(b());a.value=f}};document.createElement("textarea");ko.components.register("my_textarea",{template:'<textarea data-bind="value:text, attr:{cols:cols, rows:rows}"></textarea>',viewModel:function(a){this.text=a.text,this.rows=a.rows,this.cols=a.cols}})},!function(){if("undefined"==typeof a)var a={database:{},names:{}}}();var app=new Application(my_links);String.prototype.trim||!function(){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}();